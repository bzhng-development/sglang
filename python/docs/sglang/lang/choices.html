<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<meta name="generator" content="pdoc3 0.11.6">
<title>sglang.lang.choices API documentation</title>
<meta name="description" content="">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/sanitize.min.css" integrity="sha512-y1dtMcuvtTMJc1yPgEqF0ZjQbhnc/bFhyvIyVNb9Zk5mIGtqVaAB1Ttl28su8AvFMOY0EwRbAe+HCLqj6W7/KA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/typography.min.css" integrity="sha512-Y1DYSb995BAfxobCkKepB1BqJJTPrOp3zPL74AWFugHHmmdcvO+C48WLrUOlhGMc0QG7AE3f7gmvvcrmX2fDoA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:1.5em;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:2em 0 .50em 0}h3{font-size:1.4em;margin:1.6em 0 .7em 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .2s ease-in-out}a:visited{color:#503}a:hover{color:#b62}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900;font-weight:bold}pre code{font-size:.8em;line-height:1.4em;padding:1em;display:block}code{background:#f3f3f3;font-family:"DejaVu Sans Mono",monospace;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source > summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible;min-width:max-content}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em 1em;margin:1em 0}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul ul{padding-left:1em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ==" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => {
hljs.configure({languages: ['bash', 'css', 'diff', 'graphql', 'ini', 'javascript', 'json', 'plaintext', 'python', 'python-repl', 'rust', 'shell', 'sql', 'typescript', 'xml', 'yaml']});
hljs.highlightAll();
/* Collapse source docstrings */
setTimeout(() => {
[...document.querySelectorAll('.hljs.language-python > .hljs-string')]
.filter(el => el.innerHTML.length > 200 && ['"""', "'''"].includes(el.innerHTML.substring(0, 3)))
.forEach(el => {
let d = document.createElement('details');
d.classList.add('hljs-string');
d.innerHTML = '<summary>"""</summary>' + el.innerHTML.substring(3);
el.replaceWith(d);
});
}, 100);
})</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>sglang.lang.choices</code></h1>
</header>
<section id="section-intro">
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="sglang.lang.choices.ChoicesDecision"><code class="flex name class">
<span>class <span class="ident">ChoicesDecision</span></span>
<span>(</span><span>decision: str, meta_info: Dict[str, Any] | None = None)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@dataclass
class ChoicesDecision:
    decision: str
    meta_info: Optional[Dict[str, Any]] = None</code></pre>
</details>
<div class="desc"><p>ChoicesDecision(decision: str, meta_info: Optional[Dict[str, Any]] = None)</p></div>
<h3>Instance variables</h3>
<dl>
<dt id="sglang.lang.choices.ChoicesDecision.decision"><code class="name">var <span class="ident">decision</span> : str</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="sglang.lang.choices.ChoicesDecision.meta_info"><code class="name">var <span class="ident">meta_info</span> : Dict[str, Any] | None</code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
</dd>
<dt id="sglang.lang.choices.ChoicesSamplingMethod"><code class="flex name class">
<span>class <span class="ident">ChoicesSamplingMethod</span></span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class ChoicesSamplingMethod(ABC):

    @property
    def requires_unconditional_logprobs(self) -&gt; bool:
        return False

    @abstractmethod
    def __call__(
        self,
        *,
        choices: List[str],
        normalized_prompt_logprobs: List[float],
        input_token_logprobs: List[List[Any]],
        output_token_logprobs: List[List[Any]],
        unconditional_token_logprobs: Optional[List[List[Any]]] = None,
    ) -&gt; ChoicesDecision: ...</code></pre>
</details>
<div class="desc"><p>Helper class that provides a standard way to create an ABC using
inheritance.</p></div>
<h3>Ancestors</h3>
<ul class="hlist">
<li>abc.ABC</li>
</ul>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="sglang.lang.choices.GreedyTokenSelection" href="#sglang.lang.choices.GreedyTokenSelection">GreedyTokenSelection</a></li>
<li><a title="sglang.lang.choices.TokenLengthNormalized" href="#sglang.lang.choices.TokenLengthNormalized">TokenLengthNormalized</a></li>
<li><a title="sglang.lang.choices.UnconditionalLikelihoodNormalized" href="#sglang.lang.choices.UnconditionalLikelihoodNormalized">UnconditionalLikelihoodNormalized</a></li>
</ul>
<h3>Instance variables</h3>
<dl>
<dt id="sglang.lang.choices.ChoicesSamplingMethod.requires_unconditional_logprobs"><code class="name">prop <span class="ident">requires_unconditional_logprobs</span> : bool</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def requires_unconditional_logprobs(self) -&gt; bool:
    return False</code></pre>
</details>
<div class="desc"></div>
</dd>
</dl>
</dd>
<dt id="sglang.lang.choices.GreedyTokenSelection"><code class="flex name class">
<span>class <span class="ident">GreedyTokenSelection</span></span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class GreedyTokenSelection(ChoicesSamplingMethod):

    def __call__(
        self,
        *,
        choices: List[str],
        normalized_prompt_logprobs: List[float],
        input_token_logprobs: List[List[Any]],
        output_token_logprobs: List[List[Any]],
        unconditional_token_logprobs: Optional[List[List[Any]]] = None,
    ) -&gt; ChoicesDecision:
        &#34;&#34;&#34;Select the option based on greedy logprob selection. For overlapping options
        where one option is a subset of a longer option, extend the shorter option using
        its average logprob for comparison against the longer option.&#34;&#34;&#34;

        num_options = len(choices)
        max_tokens = max(len(option) for option in input_token_logprobs)
        logprob_matrix = self._build_logprob_matrix(
            input_token_logprobs, max_tokens, num_options
        )
        remaining = self._greedy_selection(logprob_matrix, num_options, max_tokens)

        best_choice = choices[remaining[0]]
        meta_info = {
            &#34;normalized_prompt_logprobs&#34;: normalized_prompt_logprobs,
            &#34;input_token_logprobs&#34;: input_token_logprobs,
            &#34;output_token_logprobs&#34;: output_token_logprobs,
            &#34;greedy_logprob_matrix&#34;: logprob_matrix.tolist(),
        }
        return ChoicesDecision(decision=best_choice, meta_info=meta_info)

    def _build_logprob_matrix(self, input_token_logprobs, max_tokens, num_options):
        logprob_matrix = np.zeros((num_options, max_tokens))
        for i, option in enumerate(input_token_logprobs):
            actual_logprobs = [token[0] for token in option]
            avg_logprob = np.mean(actual_logprobs)
            logprob_matrix[i, : len(option)] = actual_logprobs
            if len(option) &lt; max_tokens:
                logprob_matrix[i, len(option) :] = avg_logprob
        return logprob_matrix

    def _greedy_selection(self, logprob_matrix, num_options, max_tokens):
        remaining = np.arange(num_options)
        for j in range(max_tokens):
            max_logprob = np.max(logprob_matrix[remaining, j])
            remaining = remaining[logprob_matrix[remaining, j] == max_logprob]
            if len(remaining) == 1:
                break
        return remaining</code></pre>
</details>
<div class="desc"><p>Helper class that provides a standard way to create an ABC using
inheritance.</p></div>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="sglang.lang.choices.ChoicesSamplingMethod" href="#sglang.lang.choices.ChoicesSamplingMethod">ChoicesSamplingMethod</a></li>
<li>abc.ABC</li>
</ul>
</dd>
<dt id="sglang.lang.choices.TokenLengthNormalized"><code class="flex name class">
<span>class <span class="ident">TokenLengthNormalized</span></span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class TokenLengthNormalized(ChoicesSamplingMethod):

    def __call__(
        self,
        *,
        choices: List[str],
        normalized_prompt_logprobs: List[float],
        input_token_logprobs: List[List[Any]],
        output_token_logprobs: List[List[Any]],
        unconditional_token_logprobs: Optional[List[List[Any]]] = None,
    ) -&gt; ChoicesDecision:
        &#34;&#34;&#34;Select the option with the highest token length normalized prompt logprob.&#34;&#34;&#34;
        best_choice = choices[np.argmax(normalized_prompt_logprobs)]
        meta_info = {
            &#34;normalized_prompt_logprobs&#34;: normalized_prompt_logprobs,
            &#34;input_token_logprobs&#34;: input_token_logprobs,
            &#34;output_token_logprobs&#34;: output_token_logprobs,
        }
        return ChoicesDecision(decision=best_choice, meta_info=meta_info)</code></pre>
</details>
<div class="desc"><p>Helper class that provides a standard way to create an ABC using
inheritance.</p></div>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="sglang.lang.choices.ChoicesSamplingMethod" href="#sglang.lang.choices.ChoicesSamplingMethod">ChoicesSamplingMethod</a></li>
<li>abc.ABC</li>
</ul>
</dd>
<dt id="sglang.lang.choices.UnconditionalLikelihoodNormalized"><code class="flex name class">
<span>class <span class="ident">UnconditionalLikelihoodNormalized</span></span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class UnconditionalLikelihoodNormalized(ChoicesSamplingMethod):

    @property
    def requires_unconditional_logprobs(self) -&gt; bool:
        return True

    def __call__(
        self,
        *,
        choices: List[str],
        normalized_prompt_logprobs: List[float],
        input_token_logprobs: List[List[Any]],
        output_token_logprobs: List[List[Any]],
        unconditional_token_logprobs: Optional[List[List[Any]]] = None,
    ) -&gt; ChoicesDecision:
        &#34;&#34;&#34;Select the option with the highest average token logprob once normalized by
        the unconditional token logprobs.

        The first unconditional token logprob is assumed to be None. If so, it is
        replaced with 0 for the purposes of normalization.&#34;&#34;&#34;

        if unconditional_token_logprobs is None:
            raise ValueError(
                &#34;Unconditional token logprobs are required for this method.&#34;
            )

        normalized_unconditional_prompt_logprobs = self._normalize_logprobs(
            input_token_logprobs, unconditional_token_logprobs
        )

        best_choice = choices[np.argmax(normalized_unconditional_prompt_logprobs)]
        meta_info = {
            &#34;normalized_prompt_logprobs&#34;: normalized_prompt_logprobs,
            &#34;input_token_logprobs&#34;: input_token_logprobs,
            &#34;output_token_logprobs&#34;: output_token_logprobs,
            &#34;unconditional_token_logprobs&#34;: unconditional_token_logprobs,
            &#34;normalized_unconditional_prompt_logprobs&#34;: normalized_unconditional_prompt_logprobs,
        }
        return ChoicesDecision(decision=best_choice, meta_info=meta_info)

    def _normalize_logprobs(self, input_token_logprobs, unconditional_token_logprobs):
        normalized_unconditional_prompt_logprobs = []
        for inputs, unconditionals in zip(
            input_token_logprobs, unconditional_token_logprobs
        ):
            inputs_logprobs = np.array([token[0] for token in inputs])
            unconditionals_logprobs = np.array([token[0] for token in unconditionals])
            unconditionals_logprobs[0] = unconditionals_logprobs[0] or 0
            normalized_unconditional_prompt_logprobs.append(
                float(np.mean(inputs_logprobs - unconditionals_logprobs))
            )
        return normalized_unconditional_prompt_logprobs</code></pre>
</details>
<div class="desc"><p>Helper class that provides a standard way to create an ABC using
inheritance.</p></div>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="sglang.lang.choices.ChoicesSamplingMethod" href="#sglang.lang.choices.ChoicesSamplingMethod">ChoicesSamplingMethod</a></li>
<li>abc.ABC</li>
</ul>
<h3>Instance variables</h3>
<dl>
<dt id="sglang.lang.choices.UnconditionalLikelihoodNormalized.requires_unconditional_logprobs"><code class="name">prop <span class="ident">requires_unconditional_logprobs</span> : bool</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def requires_unconditional_logprobs(self) -&gt; bool:
    return True</code></pre>
</details>
<div class="desc"></div>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="sglang.lang" href="index.html">sglang.lang</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="sglang.lang.choices.ChoicesDecision" href="#sglang.lang.choices.ChoicesDecision">ChoicesDecision</a></code></h4>
<ul class="">
<li><code><a title="sglang.lang.choices.ChoicesDecision.decision" href="#sglang.lang.choices.ChoicesDecision.decision">decision</a></code></li>
<li><code><a title="sglang.lang.choices.ChoicesDecision.meta_info" href="#sglang.lang.choices.ChoicesDecision.meta_info">meta_info</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="sglang.lang.choices.ChoicesSamplingMethod" href="#sglang.lang.choices.ChoicesSamplingMethod">ChoicesSamplingMethod</a></code></h4>
<ul class="">
<li><code><a title="sglang.lang.choices.ChoicesSamplingMethod.requires_unconditional_logprobs" href="#sglang.lang.choices.ChoicesSamplingMethod.requires_unconditional_logprobs">requires_unconditional_logprobs</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="sglang.lang.choices.GreedyTokenSelection" href="#sglang.lang.choices.GreedyTokenSelection">GreedyTokenSelection</a></code></h4>
</li>
<li>
<h4><code><a title="sglang.lang.choices.TokenLengthNormalized" href="#sglang.lang.choices.TokenLengthNormalized">TokenLengthNormalized</a></code></h4>
</li>
<li>
<h4><code><a title="sglang.lang.choices.UnconditionalLikelihoodNormalized" href="#sglang.lang.choices.UnconditionalLikelihoodNormalized">UnconditionalLikelihoodNormalized</a></code></h4>
<ul class="">
<li><code><a title="sglang.lang.choices.UnconditionalLikelihoodNormalized.requires_unconditional_logprobs" href="#sglang.lang.choices.UnconditionalLikelihoodNormalized.requires_unconditional_logprobs">requires_unconditional_logprobs</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.11.6</a>.</p>
</footer>
</body>
</html>
